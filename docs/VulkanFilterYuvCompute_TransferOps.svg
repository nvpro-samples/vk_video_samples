<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800" width="1200" height="800">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2196F3"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4CAF50"/>
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#FF9800"/>
    </marker>
    <linearGradient id="preTransferGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#E3F2FD"/>
      <stop offset="100%" style="stop-color:#BBDEFB"/>
    </linearGradient>
    <linearGradient id="computeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#E8F5E9"/>
      <stop offset="100%" style="stop-color:#C8E6C9"/>
    </linearGradient>
    <linearGradient id="postTransferGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#FFF3E0"/>
      <stop offset="100%" style="stop-color:#FFE0B2"/>
    </linearGradient>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="800" fill="#FAFAFA"/>
  
  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#1a1a1a">
    VulkanFilterYuvCompute - Transfer Operations Pipeline
  </text>
  
  <!-- Main Pipeline Container -->
  <rect x="50" y="80" width="1100" height="300" rx="10" fill="#fff" stroke="#ccc" stroke-width="2"/>
  <text x="600" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#666">
    Command Buffer Recording Sequence
  </text>
  
  <!-- Stage 1: Pre-Transfer -->
  <rect x="80" y="130" width="300" height="220" rx="8" fill="url(#preTransferGrad)" stroke="#2196F3" stroke-width="2"/>
  <text x="230" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1565C0">
    STAGE 1: PRE-TRANSFER
  </text>
  
  <!-- Pre-transfer operations -->
  <rect x="100" y="170" width="120" height="50" rx="4" fill="#fff" stroke="#64B5F6" stroke-width="1"/>
  <text x="160" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Buffer → Image</text>
  <text x="160" y="205" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">CopyBufferToImage</text>
  
  <rect x="240" y="170" width="120" height="50" rx="4" fill="#fff" stroke="#64B5F6" stroke-width="1"/>
  <text x="300" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Linear → Optimal</text>
  <text x="300" y="205" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">CopyImage</text>
  
  <!-- Barrier 1 -->
  <rect x="100" y="235" width="260" height="40" rx="4" fill="#E3F2FD" stroke="#1976D2" stroke-width="1" stroke-dasharray="4"/>
  <text x="230" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#1565C0">
    Pipeline Barrier: TRANSFER → COMPUTE
  </text>
  
  <!-- Layout transitions -->
  <rect x="100" y="290" width="260" height="45" rx="4" fill="#fff" stroke="#90CAF9" stroke-width="1"/>
  <text x="230" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Layout Transitions</text>
  <text x="230" y="325" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">→ VK_IMAGE_LAYOUT_GENERAL</text>
  
  <!-- Stage 2: Compute -->
  <rect x="420" y="130" width="300" height="220" rx="8" fill="url(#computeGrad)" stroke="#4CAF50" stroke-width="2"/>
  <text x="570" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32">
    STAGE 2: COMPUTE
  </text>
  
  <!-- Compute operations -->
  <rect x="440" y="170" width="260" height="60" rx="4" fill="#fff" stroke="#81C784" stroke-width="1"/>
  <text x="570" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">Bind Pipeline &amp; Descriptors</text>
  <text x="570" y="207" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">vkCmdBindPipeline</text>
  <text x="570" y="220" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">vkCmdPushDescriptorSetKHR</text>
  
  <rect x="440" y="245" width="260" height="45" rx="4" fill="#C8E6C9" stroke="#66BB6A" stroke-width="2"/>
  <text x="570" y="265" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2E7D32">vkCmdDispatch</text>
  <text x="570" y="280" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">RGBA2YCBCR / YCBCR2RGBA / COPY</text>
  
  <!-- Barrier 2 -->
  <rect x="440" y="305" width="260" height="30" rx="4" fill="#E8F5E9" stroke="#388E3C" stroke-width="1" stroke-dasharray="4"/>
  <text x="570" y="325" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#2E7D32">
    Barrier: COMPUTE → TRANSFER
  </text>
  
  <!-- Stage 3: Post-Transfer -->
  <rect x="760" y="130" width="360" height="220" rx="8" fill="url(#postTransferGrad)" stroke="#FF9800" stroke-width="2"/>
  <text x="940" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#E65100">
    STAGE 3: POST-TRANSFER
  </text>
  
  <!-- Post-transfer operations -->
  <rect x="780" y="170" width="150" height="50" rx="4" fill="#fff" stroke="#FFB74D" stroke-width="1"/>
  <text x="855" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Image → Buffer</text>
  <text x="855" y="205" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">CopyImageToBuffer</text>
  
  <rect x="950" y="170" width="150" height="50" rx="4" fill="#fff" stroke="#FFB74D" stroke-width="1"/>
  <text x="1025" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Optimal → Linear</text>
  <text x="1025" y="205" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">CopyImage</text>
  
  <rect x="780" y="235" width="320" height="40" rx="4" fill="#fff" stroke="#FFB74D" stroke-width="1"/>
  <text x="940" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Image → Image (Dual Output)</text>
  <text x="940" y="270" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">Encoder + Linear Dump</text>
  
  <!-- Final Barrier -->
  <rect x="780" y="290" width="320" height="45" rx="4" fill="#FFF3E0" stroke="#F57C00" stroke-width="1" stroke-dasharray="4"/>
  <text x="940" y="310" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#E65100">
    Pipeline Barrier: TRANSFER → HOST
  </text>
  <text x="940" y="325" text-anchor="middle" font-family="monospace" font-size="9" fill="#BF360C">
    ACCESS_HOST_READ_BIT
  </text>
  
  <!-- Arrows between stages -->
  <line x1="380" y1="240" x2="415" y2="240" stroke="#2196F3" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="720" y1="240" x2="755" y2="240" stroke="#4CAF50" stroke-width="2" marker-end="url(#arrowhead-green)"/>
  
  <!-- Input/Output Resources Section -->
  <rect x="50" y="410" width="540" height="180" rx="10" fill="#fff" stroke="#9C27B0" stroke-width="2"/>
  <text x="320" y="435" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#7B1FA2">
    Input Resources
  </text>
  
  <!-- Input types -->
  <rect x="70" y="455" width="150" height="60" rx="6" fill="#F3E5F5" stroke="#BA68C8" stroke-width="1"/>
  <text x="145" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6A1B9A">Optimal Image</text>
  <text x="145" y="500" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">TILING_OPTIMAL</text>
  
  <rect x="240" y="455" width="150" height="60" rx="6" fill="#F3E5F5" stroke="#BA68C8" stroke-width="1"/>
  <text x="315" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6A1B9A">Linear Image</text>
  <text x="315" y="500" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">TILING_LINEAR</text>
  
  <rect x="410" y="455" width="150" height="60" rx="6" fill="#F3E5F5" stroke="#BA68C8" stroke-width="1"/>
  <text x="485" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#6A1B9A">Buffer</text>
  <text x="485" y="500" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">VkBuffer</text>
  
  <!-- Pre-transfer indicators -->
  <text x="145" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#4CAF50">✓ Direct Compute</text>
  <text x="315" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#2196F3">↑ Pre-Transfer</text>
  <text x="485" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#2196F3">↑ Pre-Transfer</text>
  
  <!-- Output Resources -->
  <rect x="610" y="410" width="540" height="180" rx="10" fill="#fff" stroke="#009688" stroke-width="2"/>
  <text x="880" y="435" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#00695C">
    Output Resources
  </text>
  
  <!-- Output types -->
  <rect x="630" y="455" width="150" height="60" rx="6" fill="#E0F2F1" stroke="#4DB6AC" stroke-width="1"/>
  <text x="705" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#00695C">Encoder</text>
  <text x="705" y="490" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">Optimal Image</text>
  <text x="705" y="505" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#4CAF50">✓ Direct Output</text>
  
  <rect x="800" y="455" width="150" height="60" rx="6" fill="#E0F2F1" stroke="#4DB6AC" stroke-width="1"/>
  <text x="875" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#00695C">Display</text>
  <text x="875" y="490" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">Optimal Image</text>
  <text x="875" y="505" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#4CAF50">✓ Direct Output</text>
  
  <rect x="970" y="455" width="160" height="60" rx="6" fill="#E0F2F1" stroke="#4DB6AC" stroke-width="1"/>
  <text x="1050" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#00695C">Dump/CPU Read</text>
  <text x="1050" y="490" text-anchor="middle" font-family="monospace" font-size="9" fill="#666">Linear/Buffer</text>
  <text x="1050" y="505" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#FF9800">↓ Post-Transfer</text>
  
  <!-- Transfer Types Legend -->
  <rect x="50" y="610" width="1100" height="170" rx="10" fill="#fff" stroke="#607D8B" stroke-width="2"/>
  <text x="600" y="640" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#455A64">
    Transfer Operation Types
  </text>
  
  <!-- XFER operations -->
  <rect x="80" y="660" width="320" height="100" rx="6" fill="#ECEFF1" stroke="#78909C" stroke-width="1"/>
  <text x="240" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#37474F">COPY_IMAGE_TO_BUFFER</text>
  <text x="240" y="705" text-anchor="middle" font-family="monospace" font-size="10" fill="#666">vkCmdCopyImageToBuffer()</text>
  <text x="240" y="730" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#455A64">Use case: GPU → CPU readback</text>
  <text x="240" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#455A64">File dumping, encoding input</text>
  
  <rect x="430" y="660" width="320" height="100" rx="6" fill="#ECEFF1" stroke="#78909C" stroke-width="1"/>
  <text x="590" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#37474F">COPY_BUFFER_TO_IMAGE</text>
  <text x="590" y="705" text-anchor="middle" font-family="monospace" font-size="10" fill="#666">vkCmdCopyBufferToImage()</text>
  <text x="590" y="730" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#455A64">Use case: CPU → GPU upload</text>
  <text x="590" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#455A64">Decoder output, CPU patterns</text>
  
  <rect x="780" y="660" width="340" height="100" rx="6" fill="#ECEFF1" stroke="#78909C" stroke-width="1"/>
  <text x="950" y="685" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#37474F">COPY_IMAGE_TO_IMAGE</text>
  <text x="950" y="705" text-anchor="middle" font-family="monospace" font-size="10" fill="#666">vkCmdCopyImage() / vkCmdBlitImage()</text>
  <text x="950" y="730" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#455A64">Use case: Tiling conversion</text>
  <text x="950" y="750" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#455A64">Optimal ↔ Linear, Multi-output</text>
</svg>
